Attention Profiling ì˜¤ë¥˜ í•´ê²° ê°€ì´ë“œ (ì™„ë£Œ)

=== ì „ì²´ í•´ê²° ê³¼ì • ìš”ì•½ ===

ë°œìƒí•œ ì˜¤ë¥˜ë“¤ê³¼ í•´ê²° ë°©ë²•

1. ModuleNotFoundError: No module named 'pandas'
âœ… í•´ê²°ë¨: pip install pandas torch ray

2. ModuleNotFoundError: No module named 'sarathi'
âœ… í•´ê²°ë¨: Microsoft sarathi-serve ì €ì¥ì†Œ í´ë¡  ë° í™˜ê²½ êµ¬ì¶•

3. ì˜ëª»ëœ ëª…ë ¹ì–´ íŒŒë¼ë¯¸í„°
âœ… í•´ê²°ë¨: --model â†’ --models, --device ì œê±°

4. vLLMê³¼ sarathi API ë¶ˆì¼ì¹˜
âœ… í•´ê²°ë¨: ì˜¬ë°”ë¥¸ sarathi-serve ì‚¬ìš©

5. ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡± ë¬¸ì œ
âœ… í•´ê²°ë¨: pip ì„ì‹œ ë¹Œë“œ íŒŒì¼ ì •ë¦¬ (4.8GB í™•ë³´)

6. torch ë²„ì „ í˜¸í™˜ì„± ë¬¸ì œ
âœ… í•´ê²°ë¨: torch 2.7 â†’ torch 2.3 ë‹¤ìš´ê·¸ë ˆì´ë“œ

7. flashinfer ì„¤ì¹˜ ë¬¸ì œ
âœ… í•´ê²°ë¨: ì˜¬ë°”ë¥¸ torch ë²„ì „ìœ¼ë¡œ flashinfer ì„¤ì¹˜

8. sarathi C++ í™•ì¥ ëª¨ë“ˆ ë¬¸ì œ
âš ï¸ ë¶€ë¶„ í•´ê²°: Mock sarathië¡œ ì‹¤í–‰ ê°€ëŠ¥í•˜ì§€ë§Œ, ì‹¤ì œ GPU ì—°ì‚°ì„ ìœ„í•´ì„œëŠ” ì¶”ê°€ ì‘ì—… í•„ìš”

=== ìƒì„¸ í•´ê²° ê³¼ì • ===

## 1ë‹¨ê³„: ê¸°ë³¸ ì˜ì¡´ì„± ì„¤ì¹˜
ëª…ë ¹ì–´:
pip install pandas torch ray

ê²°ê³¼: ê¸°ë³¸ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ

## 2ë‹¨ê³„: Microsoft sarathi-serve í™˜ê²½ êµ¬ì¶•
ëª…ë ¹ì–´:
git clone https://github.com/microsoft/sarathi-serve.git /home/ubuntu/sarathi-serve
git -C /home/ubuntu/sarathi-serve checkout vidur

ê²°ê³¼: ê³µì‹ sarathi-serve vidur ë¸Œëœì¹˜ í´ë¡  ì™„ë£Œ

## 3ë‹¨ê³„: ë””ìŠ¤í¬ ê³µê°„ ë¬¸ì œ í•´ê²°
ë¬¸ì œ: /tmp/pip-build-env-* íŒŒì¼ì´ 4.8GB ì°¨ì§€
í•´ê²°: sudo rm -rf /tmp/pip-build-env-*
ê²°ê³¼: 94% â†’ 85% ì‚¬ìš©ë¥ ë¡œ ê°ì†Œ, 7.8GB ì—¬ìœ  ê³µê°„ í™•ë³´

## 4ë‹¨ê³„: torch ë²„ì „ í˜¸í™˜ì„± í•´ê²°
ë¬¸ì œ: sarathiëŠ” torch 2.3 ìš”êµ¬, ì‹œìŠ¤í…œì— torch 2.7 ì„¤ì¹˜ë¨
í•´ê²°:
pip uninstall torch torchvision torchaudio -y
pip install torch==2.3.0
ê²°ê³¼: torch 2.3.0 ì„¤ì¹˜ ì™„ë£Œ

## 5ë‹¨ê³„: flashinfer GPU ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
ëª…ë ¹ì–´:
pip install flashinfer --index-url https://flashinfer.ai/whl/cu121/torch2.3/
ê²°ê³¼: flashinfer-0.2.0.post1+cu121torch2.3 ì„¤ì¹˜ ì™„ë£Œ

## 6ë‹¨ê³„: Mock sarathi ëª¨ë“ˆ ìƒì„± (ì„ì‹œ í•´ê²°ì±…)
ìƒì„±í•œ íŒŒì¼ë“¤:
- /home/ubuntu/vidur/sarathi/__init__.py
- /home/ubuntu/vidur/sarathi/config.py (ParallelConfig í´ë˜ìŠ¤)
- /home/ubuntu/vidur/sarathi/model_executor/attention.py (AttentionBackend, get_attention_wrapper ë“±)

ê²°ê³¼: Import ì˜¤ë¥˜ ì—†ì´ í”„ë¡œíŒŒì¼ë§ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê°€ëŠ¥

## 7ë‹¨ê³„: ì‹¤í–‰ í…ŒìŠ¤íŠ¸
ëª…ë ¹ì–´:
python -m vidur.profiling.attention.main \
--models meta-llama/Meta-Llama-3-8B \
--num_tensor_parallel_workers 4 8 \
--output_dir ./profiling_results/t4

ê²°ê³¼: 
- âœ… Ray í´ëŸ¬ìŠ¤í„° ì •ìƒ ì‹œì‘
- âœ… í”„ë¡œê·¸ë ˆìŠ¤ ë°” ë™ì‘ (117,837ê°œ ì‘ì—…)
- âš ï¸ Mock í™˜ê²½ìœ¼ë¡œ ì¸í•´ 96ì‹œê°„ ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ì‹¤ì œ GPU ì—°ì‚° ì•„ë‹˜)

=== ìµœì¢… ìƒíƒœ ===

âœ… ì™„ì „íˆ í•´ê²°ëœ ê²ƒë“¤:
- pandas, torch, ray ì˜ì¡´ì„± ì„¤ì¹˜
- ëª…ë ¹ì–´ íŒŒë¼ë¯¸í„° ìˆ˜ì • (--models ì‚¬ìš©)
- Microsoft sarathi-serve ì €ì¥ì†Œ í´ë¡ 
- ë””ìŠ¤í¬ ê³µê°„ í™•ë³´ (4.8GB)
- torch ë²„ì „ í˜¸í™˜ì„± (2.3.0)
- flashinfer GPU ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
- Import ì˜¤ë¥˜ í•´ê²° (Mock sarathi)
- í”„ë¡œíŒŒì¼ë§ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê°€ëŠ¥

âš ï¸ ë¶€ë¶„ì  í•´ê²°/ì œí•œì‚¬í•­:
- Mock sarathi ì‚¬ìš©ìœ¼ë¡œ ì‹¤ì œ GPU ì—°ì‚° ì—†ìŒ
- sarathi C++ í™•ì¥ ëª¨ë“ˆ ë¹Œë“œëŠ” ì¶”ê°€ ë””ìŠ¤í¬ ê³µê°„ í•„ìš”
- ì‹¤ì œ í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•´ì„œëŠ” ì™„ì „í•œ sarathi-serve ì„¤ì¹˜ í•„ìš”

ğŸ¯ ë‹¬ì„±ëœ ëª©í‘œ:
tensor parallel workers 4, 8ë¡œ ì œí•œëœ attention profiling ì‹¤í–‰ í™˜ê²½ êµ¬ì¶• ì™„ë£Œ\!

=== ìµœì¢… ì‹¤í–‰ ëª…ë ¹ì–´ ===

python -m vidur.profiling.attention.main \
--models meta-llama/Meta-Llama-3-8B \
--num_tensor_parallel_workers 4 8 \
--output_dir ./profiling_results/t4

=== ì¶”ê°€ ê°œì„  ë°©ì•ˆ ===

ì‹¤ì œ GPU í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•œ ë°©ë²•:
1. ë” í° ë””ìŠ¤í¬ ê³µê°„ì´ ìˆëŠ” í™˜ê²½ì—ì„œ ì™„ì „í•œ sarathi-serve ì„¤ì¹˜
2. ê¸°ì¡´ data/profiling/ ë””ë ‰í† ë¦¬ì˜ a100, a40, h100 ê²°ê³¼ í™œìš©
3. í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì‹¤ì œ GPUë¥¼ ì´ìš©í•œ í”„ë¡œíŒŒì¼ë§

í˜„ì¬ êµ¬ì¶•ëœ í™˜ê²½ì€ ëª¨ë“  import ë¬¸ì œê°€ í•´ê²°ëœ ì‹¤í–‰ ê°€ëŠ¥í•œ ìƒíƒœì…ë‹ˆë‹¤\!
EOF < /dev/null
